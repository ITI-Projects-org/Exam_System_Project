<div *ngIf="isLoading">Loading exam...</div>
<div *ngIf="error">{{ error }}</div>
<div *ngIf="!isLoading && !error && exam">
  <h2>{{ exam.title }}</h2>
  <p *ngIf="exam.description">{{ exam.description }}</p>
  <p>Duration: {{ exam.duration }} minutes</p>
  <p>Start Time: {{ exam.startTime | date : "short" }}</p>
  <p *ngIf="exam.endTime">End Time: {{ exam.endTime | date : "short" }}</p>
  <p *ngIf="exam.isActive">Status: Active</p>
  <div>
    exam.questions: {{ exam.questions ? "yes" : "no" }}<br />
    exam.questions.length: {{ exam.questions?.length }}<br />
    canTakeExam: {{ canTakeExam }}
  </div>
  <!-- Student answer form: select one option per question and submit -->
  <form *ngIf="exam.questions && exam.questions.length > 0 && canTakeExam" (ngSubmit)="submitExam()"
    [formGroup]="examForm">
    <div *ngFor="let question of exam.questions; let i = index">
      <p>
        <b>Q{{ i + 1 }}: {{ question.title || question.text }}</b>
      </p>
      <ul>
        <li *ngFor="let option of question.options">
          <label>
            <input type="checkbox" [checked]="isOptionSelected(question, option, i)"
              (change)="onCheckboxChange($event, question.id || i, option.id)" />
            {{ option.title || option.text }}
          </label>
        </li>
      </ul>
    </div>
    <!-- <button type="submit" [disabled]="!allQuestionsAnswered()">Submit Exam</button> -->
    <button type="submit">Submit Exam</button>
    <div *ngIf="submissionSuccess" style="color: green; margin-top: 10px">
      Exam submitted successfully!
    </div>
  </form>

  <!-- If student cannot take the exam, show questions/options as read-only -->
  <div *ngIf="exam.questions && exam.questions.length > 0 && !canTakeExam">
    <div *ngFor="let question of exam.questions; let i = index">
      <p>
        <b>Q{{ i + 1 }}: {{ question.title || question.text }}</b>
      </p>
      <ul>
        <li *ngFor="let option of question.options">
          <label>
            <input type="checkbox" [checked]="isOptionSelected(question, option, i)" />
            {{ option.title || option.text }}
          </label>
        </li>
      </ul>
    </div>
  </div>
  <div *ngIf="!canTakeExam && authService.getUserRole() === 'Student'">
    <span *ngIf="!exam.isActive">Exam is not active yet.</span>
  </div>
</div>